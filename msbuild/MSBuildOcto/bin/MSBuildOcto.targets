<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <!-- UseNativeEnvironment and _IsNativeEnvironment was used in prev versions to define if we want to use 64-bit tools when building for x64 platform. -->
        <PreferredToolArchitecture Condition="'$(PreferredToolArchitecture)' == '' and ('$(UseNativeEnvironment)' == 'true' or '$(_IsNativeEnvironment)' == 'true')">x64</PreferredToolArchitecture>
    
        <!-- By default we use the same bitness as the hosting platform -->
        <PreferredToolArchitecture Condition="'$(PreferredToolArchitecture)' == '' and ('$(PROCESSOR_ARCHITECTURE)' == 'AMD64' and '$(Platform)' == 'x64')">x64</PreferredToolArchitecture>
        <PreferredToolArchitecture Condition="'$(PreferredToolArchitecture)' == ''">x86</PreferredToolArchitecture>
     
         <!-- If OS is not x64, we cannot use x64 tools even if preferred -->
        <PreferredToolArchitecture Condition="'$(PreferredToolArchitecture)' == 'x64' and '$(PROCESSOR_ARCHITECTURE)' != 'AMD64' and '$(PROCESSOR_ARCHITEW6432)' != 'AMD64'">x86</PreferredToolArchitecture>
    </PropertyGroup>

    <ItemDefinitionGroup>
        <ClCompile>
            <AdditionalOptions Condition="1 == 1">/B2 "$(MSBuildThisFileDirectory)octobuild.$(PreferredToolArchitecture).dll" %(ClCompile.AdditionalOptions)</AdditionalOptions>
        </ClCompile>
    </ItemDefinitionGroup>
</Project>
